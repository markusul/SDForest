<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Runtime ‚Ä¢ SDForest</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Runtime">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SDForest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SDForest.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Runtime.html">Runtime</a>
    </li>
    <li>
      <a href="../articles/SDTree.html">SDTree</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Runtime</h1>
            
      

      <div class="hidden name"><code>Runtime.Rmd</code></div>

    </div>

    
    
<p>For this package, we have written methods to estimate regressions
trees and random forests to minimize the spectral objective:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mo>=</mo><msub><mtext mathvariant="normal">argmin</mtext><mrow><mi>f</mi><mi>‚Ä≤</mi><mo>‚àà</mo><mi>‚Ñ±</mi></mrow></msub><mfrac><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><mi>Q</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ùêò</mi><mo>‚àí</mo><mi>f</mi><mi>‚Ä≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ùêó</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">\hat{f} = \text{argmin}_{f' \in \mathcal{F}} \frac{||Q(\mathbf{Y} - f'(\mathbf{X}))||_2^2}{n}</annotation></semantics></math>
The package is currently fully written in <span class="citation">R Core
Team (2024)</span> for now and it gets quite slow for larger sample
sizes. There might be a faster cpp version in the future, but for now,
there are a few ways to increase the computations if you apply the
methods to larger data sets.</p>
<div class="section level2">
<h2 id="computations">Computations<a class="anchor" aria-label="anchor" href="#computations"></a>
</h2>
<p>Some speedup can be achieved by taking advantage of modern
hardware.</p>
<div class="section level3">
<h3 id="multicore">Multicore<a class="anchor" aria-label="anchor" href="#multicore"></a>
</h3>
<p>When estimating an SDForest, the most obvious way to increase the
computations is to fit the individual trees on different cores in
parallel. Parallel computing is supported for both Unix and Windows.
Depending on how your system is set up, some linear algebra libraries
might already run in parallel. In this case, the speed improvement from
choosing more than one core to run on might not be that large. Be aware
of potential RAM-overflows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fits the individual SDTrees in parallel on 22 cores</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, mc.cores <span class="op">=</span> <span class="fl">22</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gpu">GPU<a class="anchor" aria-label="anchor" href="#gpu"></a>
</h3>
<p>Especially if we have many observations, it might be reasonable to
perform the matrix multiplications on a GPU. We can evaluate many
potential splits simultaneously by multiplying an n times n matrix with
an n times potential split matrix on a GPU. We use <a href="https://cran.r-project.org/web/packages/GPUmatrix/vignettes/Vignette.html" class="external-link">GPUmatrix</a>
<span class="citation">(Lobato-Fernandez, A.Ferrer-Bonsoms, and Rubio
2024)</span> to do the calculations on the GPU. We also refer to their
website to set up your GPU properly. The number of splits that can be
evaluated in parallel in this way highly depends on your GPU size and
can be controlled using the <code>mem_size</code> parameter. The default
value of 1e+7 should not result in a memory overflow on a GPU with 24G
VRAM. For us, this worked well on a GeForce RTX 3090.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># runs the matrix operations on a gpu if available</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, gpu <span class="op">=</span> <span class="cn">T</span>, mem_size <span class="op">=</span> <span class="fl">1e+7</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDTree.html">SDTree</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, gpu <span class="op">=</span> <span class="cn">T</span>, mem_size <span class="op">=</span> <span class="fl">1e+7</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="approximations">Approximations<a class="anchor" aria-label="anchor" href="#approximations"></a>
</h2>
<p>In a few places, approximations perform almost as well as if we run
the whole procedure. Reasonable split points to divide the space of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>‚Ñù</mi><mi>p</mi></msup><annotation encoding="application/x-tex">\mathbb{R}^p</annotation></semantics></math>
are, in principle, all values between the observed ones. In practice and
with many observations, the number of potential splits grows too large.
We, therefore, evaluate maximal <code>max_candidates</code> splits of
the potential ones and choose them according to the quantiles of the
potential ones.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># approximation of candidate splits</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, max_candidates <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDTree.html">SDTree</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, max_candidates <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>If we have many observations, we can reduce computing time by only
sampling <code>max_size</code> observations from the data instead of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>.
This can dramatically reduce computing time compared to a full bootstrap
sample but could also decrease performance.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># draws maximal 500 samples from the data for each tree</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, max_size <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Lobato-Fernandez2024GPUmatrix:GPU" class="csl-entry">
Lobato-Fernandez, Cesar, Juan A.Ferrer-Bonsoms, and Angel Rubio. 2024.
<span>‚Äú<span class="nocase">GPUmatrix: Basic Linear Algebra with
GPU</span>.‚Äù</span> <a href="https://CRAN.R-project.org/package=GPUmatrix" class="external-link">https://CRAN.R-project.org/package=GPUmatrix</a>.
</div>
<div id="ref-RCoreTeam2024R:Computing" class="csl-entry">
R Core Team. 2024. <span>‚Äú<span class="nocase">R: A Language and
Environment for Statistical Computing</span>.‚Äù</span> Vienna, Austria.
<a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Markus Ulmer, Cyrill Scheidegger.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
