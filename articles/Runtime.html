<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SDForest">
<title>Runtime • SDForest</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Runtime">
<meta property="og:description" content="SDForest">
<meta property="og:image" content="https://markusul.github.io/SDForest/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SDForest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/SDForest.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Algorithm.html">Algorithm</a>
    <a class="dropdown-item" href="../articles/Runtime.html">Runtime</a>
    <a class="dropdown-item" href="../articles/SDTree.html">SDTree</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Runtime</h1>
            
      
      
      <div class="d-none name"><code>Runtime.Rmd</code></div>
    </div>

    
    
<p>For this package, we have written methods to estimate regressions
trees and random forests to minimize the spectral objective:</p>
<p><span class="math display">\[\hat{f} = \text{argmin}_{f' \in
\mathcal{F}} \frac{||Q(\mathbf{Y} -
f'(\mathbf{X}))||_2^2}{n}\]</span> With the spectral transformation,
for every potential split, we have to multiply a n times n matrix with a
vector of size n and calculate a scalar product of two vectors of size
n. The algorithm gets slow, especially for large n. Furthermore, the
package is fully written in for now. There might be a faster cpp version
in the future, but for now, there are a few ways to increase the
computations if you apply the methods to larger data sets.</p>
<div class="section level2">
<h2 id="computations">Computations<a class="anchor" aria-label="anchor" href="#computations"></a>
</h2>
<p>Some speedup can be achieved by taking advantage of modern
hardware.</p>
<div class="section level3">
<h3 id="multicore">Multicore<a class="anchor" aria-label="anchor" href="#multicore"></a>
</h3>
<p>When estimating an SDForest, the most obvious way to increase the
computations is to fit the individual trees on different cores in
parallel. Parallel computing is supported for both Unix and Windows.
Depending on how your system is set up, some linear algebra libraries
might already run in parallel. In this case, the speed improvement from
choosing more than one core to run on might not be that large.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fits the individual SDTrees in parallel on 22 cores</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, mc.cores <span class="op">=</span> <span class="fl">22</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gpu">GPU<a class="anchor" aria-label="anchor" href="#gpu"></a>
</h3>
<p>Especially if we have many observations, it might be reasonable to
perform the matrix multiplications on a GPU. We can evaluate many
potential splits simultaneously by multiplying an n times n matrix with
an n times potential split matrix on a GPU. We use <a href="https://cran.r-project.org/web/packages/GPUmatrix/vignettes/Vignette.html" class="external-link">GPUmatrix</a>
<span class="citation">(Lobato-Fernandez, A.Ferrer-Bonsoms, and Rubio
2024)</span> to do the calculations on the GPU. We also refer to their
website to set up your GPU properly. The number of splits that can be
evaluated in parallel in this way highly depends on your GPU size and
can be controlled using the <code>mem_size</code> parameter. The default
value of 1e+7 should not result in a memory overflow on a GPU with 24G
VRAM. For us, this worked well on a GeForce RTX 3090.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># runs the matrix operations on a gpu if available</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, gpu <span class="op">=</span> <span class="cn">T</span>, mem_size <span class="op">=</span> <span class="fl">1e+7</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDTree.html">SDTree</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, gpu <span class="op">=</span> <span class="cn">T</span>, mem_size <span class="op">=</span> <span class="fl">1e+7</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="approximations">Approximations<a class="anchor" aria-label="anchor" href="#approximations"></a>
</h2>
<p>In a few places, approximations perform almost as well as if we run
the whole procedure. Reasonable split points to divide the space of
<span class="math inline">\(\mathbb{R}^p\)</span> are, in principle, all
values between the observed ones. In practice and with many
observations, the number of potential splits grows too large. We,
therefore, evaluate maximal <code>max_candidates</code> splits of the
potential ones and choose them according to the quantiles of the
potential ones.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># approximation of candidate splits</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, max_candidates <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDTree.html">SDTree</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, max_candidates <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>If we have many observations, we can reduce computing time by only
sampling <code>max_size</code> observations from the data instead of
<span class="math inline">\(n\)</span>. This can dramatically reduce
computing time compared to a full bootstrap sample but could also
decrease performance.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># draws maximal 500 samples from the data for each tree</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDForest.html">SDForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, max_size <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Lobato-Fernandez2024GPUmatrix:GPU" class="csl-entry">
Lobato-Fernandez, Cesar, Juan A.Ferrer-Bonsoms, and Angel Rubio. 2024.
<span>“<span class="nocase">GPUmatrix: Basic Linear Algebra with
GPU</span>.”</span> <a href="https://CRAN.R-project.org/package=GPUmatrix" class="external-link">https://CRAN.R-project.org/package=GPUmatrix</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Markus Ulmer, Cyrill Scheidegger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
