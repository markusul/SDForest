<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SDTree • SDForest</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SDTree">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SDForest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SDForest.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Algorithm.html">Algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/Runtime.html">Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/SDTree.html">SDTree</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SDTree</h1>
            
      

      <div class="d-none name"><code>SDTree.Rmd</code></div>
    </div>

    
    
<p>In the following, we compare the spectral deconfounded regression
tree <span class="math inline">\(f^{SDTree}(X)\)</span> to the classical
regression tree <span class="math inline">\(f^{Tree}(X)\)</span> <span class="citation">(Breiman et al. 2017)</span> using simulated data from
a confounded process. We simulate the data similar to
<code><a href="../reference/simulate_data_nonlinear.html">simulate_data_nonlinear()</a></code> but with a random regression
tree, i.e. step-function for the causal relationship <span class="math inline">\(f(X)\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://markusul.github.io/SDForest/">SDForest</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">99</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># number of confounding covariates in H</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span></span>
<span><span class="co"># number of covariates in X</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># number of observations</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># number of non-zero coefficients in beta</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_data_step.html">simulate_data_step</a></span><span class="op">(</span><span class="va">q</span>, <span class="va">p</span>, <span class="va">n</span>, <span class="va">m</span>, make_tree <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Given the data, we can estimate both the deconfounded regression tree
and the classical regression tree. Here we estimate both trees with the
default parameters. One could choose, for example, the regularization
parameter cp in a more principled way than just setting it to 0.01,
e.g. <code><a href="../reference/cvSDTree.html">cvSDTree()</a></code> or <code><a href="../reference/regPath.SDTree.html">regPath.SDTree()</a></code>. But 0.01
seem like a good first try and is also the default value in <a href="https://cran.r-project.org/web/packages/rpart/index.html" class="external-link">rpart</a>
<span class="citation">(Therneau and Atkinson 2022)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">causal_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDTree.html">SDTree</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">X</span>, y <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">plain_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDTree.html">SDTree</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">X</span>, y <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">Y</span>, Q_type <span class="op">=</span> <span class="st">'no_deconfounding'</span>, cp <span class="op">=</span><span class="op">)</span></span></code></pre></div>
<p>Let us observe, what the different trees predict, by comparing the
predictions to the causal function and the observed response. On top, we
show the underlying causal step function <span class="math inline">\(f^0(X)\)</span> against the 5 covariates used for
splitting partitions. On the bottom, we see the observed response <span class="math inline">\(Y\)</span>. The spectral deconfounded regression
tree <span class="math inline">\(f^{SDTree}(X)\)</span> predicts almost
the same response as the true underlying function. The plain classical
regression tree, on the other hand, results in a prediction close to the
observed <span class="math inline">\(\mathbf{Y}\)</span>.</p>
<p><img src="SDTree_files/figure-html/pred-1.png" width="700"></p>
<p>Now, we can directly look at the estimated tree structures. On top is
the true underlying random regression tree, and below are the two tree
estimates. In the middle is the spectral deconfounded regression tree
and on the bottom is the plain classical regression tree. The nodes that
choose a covariate for a split, that is also used in the true underlying
causal function, are marked in <span style="color: #b0193c;">red</span>.
Besides <span class="math inline">\(X_{320}\)</span>, the spectral
deconfounded regression tree uses all covariates for splits with a
causal relationship with <span class="math inline">\(Y\)</span>. Since
<span class="math inline">\(X_{584}\)</span> only splits three
observations into the node with a response level of 49.6, it seems
reasonable that the noise and confounding in the observed data
overshadow this effect. The order of the splits in the spectral
deconfounded regression tree is partially different from the true
function. <span class="math inline">\(X_{369}\)</span> is used too early
resulting in having to split with <span class="math inline">\(X_{250}\)</span> and <span class="math inline">\(X_{89}\)</span> in both following subtrees.
Estimating the partitions using no deconfounding results in the
regression tree on the bottom right. Here, we only find two of the
causal relevant covariates. Especially problematic is that the not
deconfounded regression tree first splits with a few irrelevant
covariates. Therefore, if an observation has <span class="math inline">\(X_{486} &gt; -0.9\)</span> or <span class="math inline">\(X_{430} \leq -2.7\)</span>, which has no meaning
in the underlying function, no relevant split is left in the
sub-tree.</p>
<p><img src="SDTree_files/figure-html/plot_tree-1.png" width="700"><img src="SDTree_files/figure-html/plot_tree-2.png" width="700"><img src="SDTree_files/figure-html/plot_tree-3.png" width="700"></p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Breiman2017ClassificationTrees" class="csl-entry">
Breiman, Leo, Jerome H. Friedman, Richard A. Olshen, and Charles J.
Stone. 2017. <em><span>Classification And Regression Trees</span></em>.
Routledge. <a href="https://doi.org/10.1201/9781315139470" class="external-link">https://doi.org/10.1201/9781315139470</a>.
</div>
<div id="ref-Therneau2022Rpart:Trees" class="csl-entry">
Therneau, Terry, and Beth Atkinson. 2022. <span>“<span class="nocase">rpart: Recursive Partitioning and Regression
Trees</span>.”</span> <a href="https://CRAN.R-project.org/package=rpart" class="external-link">https://CRAN.R-project.org/package=rpart</a>.
</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Markus Ulmer, Cyrill Scheidegger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
